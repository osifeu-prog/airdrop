[build]
builder = "nixpacks"

[deploy]
numReplicas = 1
healthcheckPath = "/health"
healthcheckTimeout = 60
restartPolicyType = "always"

# ===== SERVICE: WEB API =====
[[services]]
name = "api"
priority = 1
httpPort = 8000
healthcheckPath = "/health"
healthcheckTimeout = 30
startTimeout = 60

[services.env]
PORT = "8000"
NODE_ENV = "production"
PYTHONUNBUFFERED = "true"

# ===== SERVICE: TELEGRAM BOT =====
[[services]]
name = "bot"
priority = 2
run = "python bot/updated_bot.py"
startTimeout = 60

[services.env]
TELEGRAM_TOKEN = "8530795944:AAFXDx-vWZPpiXTlfsv5izUayJ4OpLLq3Ls"
API_URL = "https://${RAILWAY_STATIC_URL}"
PYTHONUNBUFFERED = "true"

# ===== ENVIRONMENT VARIABLES (Shared) =====
[variables]
TON_WALLET_ADDRESS = "UQCr743gEr_nqV_0SBkSp3CtYS_15R3LDLBvLmKeEv7XdGvp"
AIRDROP_PRICE_ILS = "44.4"
PAYMENT_CURRENCY = "TON"
PAYMENT_PROVIDER = "ton"

# Database (if added later)
# DATABASE_URL = "postgresql://postgres:password@localhost:5432/airdrop"
# REDIS_URL = "redis://localhost:6379/0"

# Admin
# ADMIN_ID = "123456789"

# ===== DEPLOYMENT HOOKS =====
[[deploy.hooks]]
command = "python -c 'print(\"🚀 Deployment started!\")'"
type = "pre-deploy"

[[deploy.hooks]]
command = "pip install -r requirements.txt"
type = "build"

[[deploy.hooks]]
command = "python -c 'print(\"✅ Build completed successfully!\")'"
type = "post-build"

# ===== HEALTH CHECKS =====
[[healthchecks]]
name = "api-health"
path = "/health"
initialDelay = 10
timeout = 5
interval = 30

[[healthchecks]]
name = "api-root"
path = "/"
initialDelay = 15
timeout = 5
interval = 60

# ===== VOLUMES (if needed for persistence) =====
# [[volumes]]
# name = "data"
# mountPath = "/app/data"
# size = "1GB"
